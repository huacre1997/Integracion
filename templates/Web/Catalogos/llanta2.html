{% extends 'Web/Catalogos/catalogos_base.html' %}
{% block blockCatalogos%}nav-item active{% endblock %}
{% block collapseCatalogos %}collapse show{% endblock %}
{% block llantas %}collapse-item active{% endblock %}
{% load static %}
{% block content %}
{% load base_extras %}

<style>
  table.dataTable th:nth-child(6) {
    width: 20px;
    max-width: 20px;
    word-break: break-all;
    white-space: pre-line;
  }

  .important {
    border-color: red !important;
  }

  .section {
    transition: opacity 0.5s ease-out;
    opacity: 0;
    height: 0;
    overflow: hidden;
  }

  .section.activo {
    opacity: 1;
    height: auto;
  }
</style>
<div id="wrapper">
  <div class="container-fluid">
    <div class="card shadow mb-4">
      <div class="card-header py-3">
        <div class="row">
          <h6 class="m-0 font-weight-bold text-primary"><i class="fa fa-edit"></i>
            {% if update %} Editar Neumático {% else %} Crear Neumático {% endif %}</h6>
        </div>
      </div>
      <div class="card-body">

        <div class="table-responsive">
          <table class="table  table-hover table-bordered" id="tablaLlanta" style="width: 100%;">
            <thead>
              <th style="width: 10%;">Código</th>
              <th style="width: 10%;"> Marca</th>
              <th style="width: 10%;">Modelo</th>
              <th style="width: 16%;">Medida</th>
              <th style="width: 15%;">Estado</th>
              <th style="width: 10%;">Fecha</th>
              <th style="width: 8%;">Costo</th>
              <th style="width: 8%;">Altura Ini.</th>
              <th style="width: 8%;">Altura Fin.</th>
              <th style="width: 5%;"></th>

            </thead>
            <tbody>


            </tbody>


          </table>
        </div>
        <button type="button" id="btn-save" class="btn btn-primary btn-block">Guardar</button>

      </div>
    </div>

  </div>
</div>

{% endblock %}
{% block bottom_scripts %}
<!-- <script type='text/javascript' src="{% static 'js/jquery.mousewheel.min.js' %}"></script> -->

<script>
  $(document).ready(function () {
    $("#btn-save").on("click", function (e) {
       
      e.preventDefault()
      if (objeto.items.length === 0) {
        notificacion(2000, "Debes ingresar almenos una llanta!", "error")
        return false;
      } else {
        
        let b = 0
        $.each($(".form"), function (index, value) {
          let name = $(value).attr("name")

          if ($(value).hasClass("is-invalid")) {
            b = b + 1
            $("#btn-save").prop("disabled", true)
          }
        });

        if (b == 0) {
           $("#loadingCharge").css("visibility","visible")
        $("#spinner").css("visibility","visible")
          let result = !Object.values(objeto.items).every(o => o === "")
          confirmar(function () {
            var parameters = new FormData();
            parameters.append("objeto", JSON.stringify(objeto.items))
            fetch(window.location.href, {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
                "X-CSRFToken": csrftoken
              },
              body: JSON.stringify(objeto.items),

            }).then(l => l.json()).then(res => {
             
              window.localStorage.clear()
              objeto.items = []
              objeto.list()
               $("#loadingCharge").css("visibility","hidden")
              $("#spinner").css("visibility","hidden")
              notificacion(2000, "Neumáticos guardados!", "success")

            })
          }, "Está a punto de ingresar " + objeto.items.length + " neumáticos!")
                 
          $("#btn-save").prop("disabled", false)
        }
      }
    });
    $("#btn-click").on("click", function (param) {
      document.getElementById("btn-click").disabled = true
      $("#submit-form").click()
    })
    var tablaLLantas
    var data = {
      codigo: "",
      marca: "",
      modelo: "",
      medida: "",
      estado: "",
      altura_ini: "",
      altura_fin: "",
      costo: "",
      fech_ren: "",
      cubierta: []
    }
    var objeto = {
      items: [],
      cu: [],
      list: function () {
        tablaLLantas = $("#tablaLlanta").DataTable({
          searching: false,
          ordering: false,
          paging: false,
          info: false,
          data: this.items,
          destroy: true,
          columns: [


            {
              "data": 'codigo',
              className: "middle"
            },


            {
              "data": "marca",
              className: "middle"

            },
            {
              "data": "modelo",
              className: "middle"

            },
            {
              "data": 'medida',
              className: "middle"
            },
            {
              "data": 'estado',
              className: "middle"
            },

            {
              "data": 'fech_ren',
              className: "middle"
            },

            {
              "data": 'costo',
              className: "middle"
            },
            {
              "data": 'altura_ini',
              className: "middle"
            },

            {
              "data": 'altura_fin',
              className: "middle"
            },
            {
              "data": null,
              className: "middle"
            },
          ],
          // "createdRow": function (row, data, index) {
          //   console.log("eNTRO AL CREATED ROW");
          //   if (data.codigo == "" && data.marca != "") {
          //     fetch('/catalogos/render-option-llanta/' + data.marca).then(res => res
          //         .json())
          //       .then(re => {
          //         var select = $(row).find("select[name='modelo_llanta']")
          //         select.prop("disabled", true)
          //         select.prop("disabled", false)
          //         $.each(re, function (index, valuex) {
          //           if (!valuex.eliminado && valuex.activo) {
          //             let opcion = document.createElement("option")
          //             opcion.value = valuex.id
          //             opcion.textContent = valuex.descripcion
          //             select.append(opcion)

          //           }
          //         });
          //         select.prop("disabled", false)
          //         select.find('option[value="' + data.modelo + '"]').attr('selected', 'selected');
          //       })

          //   }
          // },
          columnDefs: [

            {
              targets: [0],
              width: "10%",
              render: function (data, type, row) {
                return `<input type="number" name="codigo" min="1" onkeypress="return event.charCode >= 48" class="form-control form" maxlength="100" value="${data}">`;
              }
            },

            {
              targets: [1],
              width: "10%",

              render: function (data, type, row) {
                var $select = $('<select name="marca_llanta"  class="form form-select change_marca">' +
                  ' <option value="0">Seleccione...</option>' +
                  '{% for i in marca_llanta  %}' +
                  '{% if  i.activo and not i.eliminado or obj.modelo_llanta.marca_llanta.id == i.id %}' +
                  '<option value="{{i.id}}">{{i.descripcion}}</option>' +
                  '{% endif %}' +
                  '{% endfor %}' +
                  '</select>');
                $select.find('option[value="' + row.marca + '"]').attr('selected', 'selected');
                return $select[0].outerHTML
              }
            },
            {
              targets: [2],
              width: "10%",
              render: function (data, type, row) {
                var $select = $('<select name="modelo_llanta"  class="form form-select">' +
                  '</select>');


                $select.find('option[value="' + data + '"]').attr('selected', 'selected');
                return $select[0].outerHTML
              }
            },
            {
              targets: [3],
              width: "16%",

              render: function (data, type, row) {
                var $select = $('<select name="medida_llanta"  class="form form-select">' +
                  ' <option value="0">Seleccione...</option>' +

                  '{% for i in medida_llanta  %}' +
                  '{% if  i.activo and not i.eliminado or obj.medida_llanta.id == i.id %}' +
                  '<option value="{{i.id}}" {% if obj.medida_llanta.id == i.id %}selected{% endif %}>Medida {{i.medida}}-{{i.profundidad}}' +
                  '{% if i.capas %}' +
                  '-{{i.capas}}' +
                  '{% else %}' +
                  '{% endif %}' +
                  '</option>' +
                  '{% endif %}' +
                  '{% endfor %}' +
                  '</select>');
                $select.find('option[value="' + row.medida + '"]').attr('selected', 'selected');
                return $select[0].outerHTML


              }
            },
            {
              targets: [4],
              width: "15%",

              render: function (data, type, row) {
                if (data == "1" || data == "") {
                  var $select = $(
                    '<div class="input-group"><select name="estado_llanta"  class="form form-select">' +
                    ' <option value="0">Seleccione...</option>' +
                    '{% for i in estado  %}' +
                    '<option value="{{i.0}}">{{i.1}}</option>' +
                    '{% endfor %}' +
                    '</select><button class="btn btn-outline-secondary" disabled type="button"><i class="fas fa-eye"></i></button></div>'
                  );
                  $select.find('option[value="' + row.estado + '"]').attr('selected', 'selected');
                  return $select[0].outerHTML
                } else {
                  var $select = $(
                    '<div class="input-group"><select name="estado_llanta"  class="form form-select">' +
                    ' <option value="0">Seleccione...</option>' +
                    '{% for i in estado  %}' +
                    '<option value="{{i.0}}">{{i.1}}</option>' +
                    '{% endfor %}' +
                    '</select><button class="btn btn-outline-secondary btn-reencauche"  type="button"><i class="fas fa-eye"></i></button></div>'
                  );
                  $select.find('option[value="' + row.estado + '"]').attr('selected', 'selected');
                  return $select[0].outerHTML
                }
              }
            },
            {
              targets: 5,
              width: "10%",


              render: function (data, type, row) {


                return `<input type="date" style="width:153px" name="fech_ren" class="form form-control" value="${data}" >`;

              }
            },

            {
              targets: [6],
              width: "8%",

              render: function (data, type, row) {

                return `<input type="number" name="costo" step="0.01" min="0.00" class="form form-control" value="${data}">`;

              }
            },
            {
              targets: [7],
              width: "8%",

              render: function (data, type, row) {

                return `<input type="number" name="a_inicial" step="0.01"  min="0.00" class="form form-control" value="${data}" >`;

              }
            },
            {
              targets: [8],
              width: "8%",

              render: function (data, type, row) {

                return `<input type="number" name="a_final" step="0.01" min="0.00" class="form form-control" value="${data}">`;

              }
            },
            {
              targets: [9],
              width: "5%",

              render: function (data, type, row) {
                if (data.codigo != "") {
                  return `<button class="btn btn-success btn-remove"><i class="fas fa-check"></i></button>`;

                } else {
                  return `<button class="btn btn-primary btn-add"><i class="fas fa-plus"></i></button>`;

                }

              }
            },
          ],
          "language": {

            "processing": '<div class="spinner-border text-primary" style="width: 3rem; height: 3rem; role="status"><span class="sr-only">Loading...</span></div>',
            "lengthMenu": "Mostrar _MENU_ registros",
            "zeroRecords": "No se encontraron resultados",
            "emptyTable": "Ningún dato disponible en esta tabla",
            "info": "Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",
            "infoEmpty": "Mostrando registros del 0 al 0 de un total de 0 registros",
            "infoFiltered": "(filtrado de un total de _MAX_ registros)",
            "search": "Buscar:",
            "infoThousands": ",",
            "loadingRecords": "Cargando...",

          },
          initComplete: function (settings, json) {
            $(function () {

              function refreshStorage() {
                window.localStorage.removeItem("array")
                window.localStorage.setItem("array", JSON.stringify(objeto.items))
              }
              for (let index = 0; index < settings.aoData.length - 1; index++) {
                const element = settings.aoData[index]._aData
                if (element.estado == "2" && element.cubierta.length == 0) {
                  $(settings.aoData[index].anCells[4]).find("button").removeClass(
                    "btn-outline-secondary").addClass("btn-danger");
                  $("#btn-save").prop("disabled", true)

                }
              }

              function load(tabla, a, b, c, d, e, f, g, tr,h,settings) {
                function center(param) {
                  param.classList.add("text-center", "middle")
                }
                let trp = document.createElement("tr")
                let td_nro = document.createElement("td")
                center(td_nro)
                let td_km = document.createElement("td")
                center(td_km)
                let td_renova = document.createElement("td")
                td_renova.classList.add("middle")
                let td_modelo_b = document.createElement("td")
                td_modelo_b.classList.add("middle")

                let td_ancho_b = document.createElement("td")
                td_ancho_b.classList.add("middle")

                let td_fech = document.createElement("td")
                center(td_fech)
                let td_alt_inicial = document.createElement("td")
                center(td_alt_inicial)
                let td_alt_final = document.createElement("td")
                center(td_alt_final)
                let td_btn = document.createElement("td")
                let btn = document.createElement("button")
                let i = document.createElement("i")

                btn.classList.add("btn", "btn-danger")
                $(btn).on("click", function () {
                  let index = $(this).parent().parent()
                  confirmar(function () {
                    if (typeof objeto.items[tr] !== "undefined") {

                    objeto.items[tr].cubierta.splice(index.index(), 1)
                    refreshStorage()
                    }
                    else{
                     
                      settings.aoData[tr]._aData.cubierta.splice(tr, 1)
                    }
                    index.remove();

                  }, "¿Desea eliminar este reencauche de la lista?", function () {

                  })
                })
                i.classList.add("fas", "fa-trash")
                btn.append(i)
                td_nro.textContent = a
                td_km.textContent = b
                td_renova.textContent = c
                td_modelo_b.textContent = d
                td_ancho_b.textContent = e
                td_fech.textContent = f
                td_alt_inicial.textContent = g
                td_alt_final.textContent = h

                td_btn.append(btn)
                trp.append(td_nro)
                trp.append(td_km)
                trp.append(td_alt_inicial)
                trp.append(td_alt_final)

                trp.append(td_renova)
                trp.append(td_modelo_b)
                trp.append(td_ancho_b)
                trp.append(td_fech)

                trp.append(td_btn)
                tabla.append(trp)
              }
              var html =
                '<div class="p-3 container-fluid">' +
                '<div class="row">' +
                '<div class="col-lg-12 mb-3">' +
                '<div class="form-row">' +
                '<div class="col-lg-3 ">' +
                '<label  class="formName">N° Reencauche</label>' +
                '<input type="number" min="0" max="6"  class="nro_reencauchado form-control" required />' +
                '</div>' +
                '<div class="col-lg-3">' +
                '<label  class="formName">Kilometraje</label>' +
                '<input type="number"  step="0.01" min="0.00" class="km form-control" required />' +
                '</div>' +
                '<div class="col-lg-3">' +
                '<label  class="formName">Alt.Inicial</label>' +
                '<input type="number"   step="0.01" min="0.00" class="alt_inicial form-control" required />' +
                '</div>' +
                '<div class="col-lg-3">' +
                '<label  class="formName">Alt.Final</label>' +
                '<input type="number"   step="0.01" min="0.00" class="alt_final form-control" required />' +
                '</div>' +
         
                '</div>' +
                '<div class="form-row">' +
                  '<div class="col-lg-3">' +
                '<label  class="formName">Fecha Reencauche</label>' +
                '<input type="date" class="fecha_ren form-control" required />' +
                '</div>' +
                '<div class="col-lg-3">' +

                '<label class="formName">Reencauchadora</label>' +
                '<select class="renovadora form-select"  required />' +
                '<option value="0">Seleccione..</option>' +
                '{% for i in renova %}' +
                '{% if  i.activo and not i.eliminado%}' +
                '<option value="{{i.id}}">{{i.descripcion}}</option>' +
                '{%endif%}' +
                '{%endfor%}' +
                '</select>' +
                '</div>' +
                '<div class="col-lg-3">' +

                '<label class="formName">Modelo de la Banda</label>' +
                '<select class="modelo_renova form-select" required />' +
                '</select>' +
                '</div>' +
                '<div class="col-lg-3">' +

                '<label class="formName">Ancho de Banda</label>' +
                '<select class="ancho_banda form-select" required />' +
                '</select>' +
                '</div>' +
                '<div class="offset-lg-9 col-lg-3 mt-2  ">' +
                '<button class="btn  btn-primary btn-block btn-add-r" /><i class="fas fa-sign-in-alt"></i>&nbsp;Agregar' +
                '</button>' +
                '</div>' +
                '</div>' +
                '</div>' +
                '<div class="col-lg-12">' +
                '<table  class="table renova_table table-bordered" style="width: 100%;">' +
                '<thead>' +
                '<th class="text-center middle">N° Reenc.</th>' +
                '<th class="text-center middle">Km</th>' +
                '<th class="text-center middle">Alt.Inicial</th>' +
                '<th class="text-center middle">Alt.Final</th>' +

                '<th class="middle">Reencauchadora</th>' +
                '<th class="middle">Modelo de Banda</th>' +
                '<th class="middle">Ancho de Banda</th>' +
                '<th  class="text-center middle">Fecha</th>' +
                '<th class="text-center middle"></th>' +
                '</thead>' +
                '<tbody class="t_body">' +
                '</tbody>' +
                '</table>' +
                '</div>' +
                '</div>' +
                '</div>'

              function openReencauche(tr, that) {
                $.confirm({
                  containerFluid: false,
                  theme: "material",
                  title: 'Agregar Reencauche',
                  content: html,
                  columnClass: 'col-md-12 col-xs-12',
                  buttons: {
                    Guardar: {
                      text: 'Guardar',
                      btnClass: 'btn-dark',
                      action: function (e) {
                        settings.aoData[tr.row]._aData.cubierta = objeto.cu
                        objeto.cu = []
                        refreshStorage()
                        // if(settings.aoData.length-1!=tr.row){
                        if (settings.aoData[tr.row]._aData.cubierta.length > 0) {
                          $(that).removeClass("btn-danger").addClass("btn-outline-secondary")
                          $("#btn-save").prop("disabled", false)
                        } else {
                          $(that).addClass("btn-danger").removeClass("btn-outline-secondary")
                          if(tr.row==settings.aoData.length-1)
                          {
                            $("#btn-save").prop("disabled", false)

                          }else{
                            
                            $("#btn-save").prop("disabled", true)

                          
                          }

                        }
                        // }
                        // let error = 0
                        // const validar = (num, that) => {
                        //   if (num == "0" || num == "") {
                        //     error = 1
                        //     $(that).addClass("is-invalid")
                        //     $(that).on("input change", function () {
                        //       $(that).removeClass("is-invalid")
                        //     })
                        //   }
                        // }
                        // var nro_reencauchado = this.$content.find('.nro_reencauchado')
                        //   .val();
                        // var km = this.$content.find('.km').val();
                        // var renovadora = this.$content.find('.renovadora').val();
                        // var modelo_banda = this.$content.find('.modelo_renova').val();
                        // var ancho_banda = this.$content.find('.ancho_banda').val();
                        // validar(nro_reencauchado, this.$content.find('.nro_reencauchado'))
                        // validar(km, this.$content.find('.km'))
                        // validar(renovadora, this.$content.find('.renovadora'))
                        // validar(modelo_banda, this.$content.find('.modelo_renova'))
                        // validar(ancho_banda, this.$content.find('.ancho_banda'))

                        // if (error == 0) {
                        //   settings.aoData[tr.row]._aData.cubierta.nro_reencauchado =
                        //     nro_reencauchado
                        //   settings.aoData[tr.row]._aData.cubierta.renovadora = renovadora
                        //   settings.aoData[tr.row]._aData.cubierta.modelo_banda = modelo_banda
                        //   settings.aoData[tr.row]._aData.cubierta.ancho_banda = ancho_banda
                        //   settings.aoData[tr.row]._aData.cubierta.km = km
                        // } else {
                        //   return false
                        // }
                      }
                    },
                  },
                  onContentReady: function () {
                    var jc = this;
                    let km = settings.aoData[tr.row]._aData.cubierta.km
                    let nro_reencauchado = settings.aoData[tr.row]._aData.cubierta
                      .nro_reencauchado
                    let renovadora = settings.aoData[tr.row]._aData.cubierta.renovadora
                    let modelo_banda = settings.aoData[tr.row]._aData.cubierta.modelo_banda
                    let ancho_banda = settings.aoData[tr.row]._aData.cubierta.ancho_banda
                    let fecha_ren = settings.aoData[tr.row]._aData.cubierta.fech_ren
                    let alt_inicial = settings.aoData[tr.row]._aData.cubierta.alt_inicial

                    let renovadora_input = this.$content.find('.renovadora')
                    let modelo_banda_input = this.$content.find('.modelo_renova')
                    let ancho_banda_input = this.$content.find('.ancho_banda')
                    let km_input = this.$content.find('.km')
                    let nro_input = this.$content.find('.nro_reencauchado')
                    let fech_input = this.$content.find('.fecha_ren')
                    let alt_inicial_input = this.$content.find('.alt_inicial')
                    let alt_final_input = this.$content.find('.alt_final')

                    let btn_add = this.$content.find('.btn-add-r')
                    let tabla = this.$content.find('.t_body')

                    objeto.cu = settings.aoData[tr.row]._aData.cubierta
                    let array = settings.aoData[tr.row]._aData.cubierta
                    for (let index = 0; index < array.length; index++) {
                      const e = array[index];
                      load(tabla, e.nro_reencauchado, e.km, e.renovadora.descripcion, e
                        .modelo_banda.descripcion,
                        e.ancho_banda.descripcion, e.fech_ren, e.alt_inicial, tr.row,e.alt_final)
                    }
                    var obj = {
                      fech_ren: "",
                      alt_inicial: "",
                      alt_final:"",
                      nro_reencauchado: "",
                      km: "",
                      renovadora: {
                        id: "",
                        descripcion: ""
                      },
                      modelo_banda: {
                        id: "",
                        descripcion: ""
                      },
                      ancho_banda: {
                        id: "",
                        descripcion: ""
                      },
                    }
                    // if (renovadora != null) {
                    //   renovadora_input.find('option[value="' + renovadora + '"]').attr(
                    //     'selected', 'selected');
                    //   modelo_banda_input.empty();
                    //   modelo_banda_input.append($("<option>", {
                    //     value: "0",
                    //     text: " Seleccione... "
                    //   }));
                    //   fetch('/catalogos/render-option?id_marca=' + renovadora)
                    //     .then(
                    //       res => res
                    //       .json())
                    //     .then(data => {
                    //       $.each(data, function (index, valuex) {
                    //         if (!valuex.eliminado && valuex.activo) {
                    //           let opcion = document.createElement("option")
                    //           opcion.value = valuex.id
                    //           opcion.textContent = valuex.descripcion
                    //           modelo_banda_input.append(opcion)
                    //         }
                    //       });

                    //       modelo_banda_input.find('option[value="' + modelo_banda + '"]')
                    //         .attr(
                    //           'selected', 'selected');
                    //       ancho_banda_input.empty();
                    //       ancho_banda_input.append($("<option>", {
                    //         value: "0",
                    //         text: " Seleccione... "
                    //       }));
                    //       fetch('/catalogos/render-option-renova?id_marca_renova=' +
                    //           modelo_banda)
                    //         .then(
                    //           res => res
                    //           .json())
                    //         .then(data => {
                    //           $.each(data, function (index, valuex) {
                    //             if (!valuex.eliminado && valuex.activo) {
                    //               let opcion = document.createElement("option")
                    //               opcion.value = valuex.id
                    //               opcion.textContent = valuex.descripcion
                    //               ancho_banda_input.append(opcion)
                    //             }
                    //           });

                    //           if (ancho_banda != null) {
                    //             ancho_banda_input.find('option[value="' + ancho_banda +
                    //               '"]').attr(
                    //               'selected', 'selected');
                    //           }
                    //         })
                    //     })

                    // }


                    // if (km != "") {
                    //   this.$content.find('.km').val(km)
                    // }
                    // if (nro_reencauchado != "") {
                    //   this.$content.find('.nro_reencauchado').val(nro_reencauchado)
                    // }
                    nro_input.on("input", function () {

                      if ($(this).val() != "" && objeto.items.length > 0 && typeof objeto
                        .items[tr.row] !== "undefined") {
                        objeto.items[tr.row].cubierta.nro_reencauchado = $(this).val();
                        refreshStorage()
                      }
                    })
                    km_input.on("input", function () {
                      if ($(this).val() != "" && objeto.items.length > 0 && typeof objeto
                        .items[tr.row] !== "undefined") {
                        objeto.items[tr.row].cubierta.km = $(this).val();
                        refreshStorage()
                      }
                    })

                    renovadora_input.on("change", function () {
                      if ($(this).val() != "" && objeto.items.length > 0 && typeof objeto
                        .items[tr.row] !== "undefined") {
                        objeto.items[tr.row].cubierta.renovadora = $(this).val();
                        refreshStorage()
                      }
                      modelo_banda_input.prop("disabled", true)
                      modelo_banda_input.empty();
                      modelo_banda_input.append($("<option>", {
                        value: "0",
                        text: " Seleccione... "
                      }));
                      ancho_banda_input.prop("disabled", true)
                      ancho_banda_input.empty();
                      ancho_banda_input.append($("<option>", {
                        value: "0",
                        text: " Seleccione... "
                      }))
                      fetch('/catalogos/render-option?id_marca=' + $(this).val()).then(
                          res => res
                          .json())
                        .then(data => {
                          $.each(data, function (index, valuex) {
                            if (!valuex.eliminado && valuex.activo) {
                              let opcion = document.createElement("option")
                              opcion.value = valuex.id
                              opcion.textContent = valuex.descripcion
                              modelo_banda_input.append(opcion)

                            }
                          });
                          if ($(this).val() == "0") {
                            modelo_banda_input.prop("disabled", true)
                          } else {
                            modelo_banda_input.prop("disabled", false)
                          }
                        })

                      obj.renovadora.id = $(this).val()
                      obj.renovadora.descripcion = $(this).find("option:selected").text()
                    })
                    modelo_banda_input.on("change", function () {

                      ancho_banda_input.prop("disabled", true)
                      ancho_banda_input.empty();
                      ancho_banda_input.append($("<option>", {
                        value: "0",
                        text: " Seleccione... "
                      }));
                      fetch('/catalogos/render-option-renova?id_marca_renova=' + $(this)
                          .val()).then(
                          res => res
                          .json())
                        .then(data => {
                          $.each(data, function (index, valuex) {
                            if (!valuex.eliminado && valuex.activo) {
                              let opcion = document.createElement("option")
                              opcion.value = valuex.id
                              opcion.textContent = valuex.descripcion+" ("+valuex.ancho_banda+" mm)"
                              ancho_banda_input.append(opcion)
                            }
                          });
                          if ($(this).val() == "0") {
                            ancho_banda_input.prop("disabled", true)
                          } else {
                            ancho_banda_input.prop("disabled", false)
                          }
                        })
                      if ($(this).val() != "" && objeto.items.length > 0 && typeof objeto
                        .items[tr.row] !== "undefined") {

                        objeto.items[tr.row].cubierta.modelo_banda = $(this).val();
                        refreshStorage()
                      }
                      obj.modelo_banda.id = $(this).val()
                      obj.modelo_banda.descripcion = $(this).find("option:selected").text()

                    })
                    ancho_banda_input.on("change", function () {
                      if ($(this).val() != "" && objeto.items.length > 0 && typeof objeto
                        .items[tr.row] !== "undefined") {
                        objeto.items[tr.row].cubierta.ancho_banda = $(this).val();
                        refreshStorage()

                      }
                      obj.ancho_banda.id = $(this).val()

                      obj.ancho_banda.descripcion = $(this).find('option:selected').text();
                    })
                    renovadora_input.select2({
                      dropdownParent: $(".jconfirm-cell")
                    })
                    modelo_banda_input.select2({
                      dropdownParent: $(".jconfirm-cell")
                    })
                    ancho_banda_input.select2({
                      dropdownParent: $(".jconfirm-cell")
                    })

                    btn_add.on("click", function () {
                      const validar = (num, that) => {
                        if (num == "0" || num == "") {
                          error = 1
                          $(that).addClass("is-invalid")
                          alerta(1500, "error", "Ingrese todos los campos.")
                          $(that).on("input change", function () {
                            $(that).removeClass("is-invalid")
                          })
                        }
                      }

                      let error = 0
                      obj.km = km_input.val()
                      obj.nro_reencauchado = nro_input.val()
                      obj.fech_ren = fech_input.val()
                      obj.alt_inicial = alt_inicial_input.val()
                      obj.alt_final = alt_final_input.val()

                      validar(km_input.val(), km_input)
                      validar(nro_input.val(), nro_input)
                      validar(renovadora_input.val(), renovadora_input)
                      validar(modelo_banda_input.val(), modelo_banda_input)
                      validar(ancho_banda_input.val(), ancho_banda_input)

                      validar(fech_input.val(), fech_input)
                      if(checkDate(fech_input.val())){

                        fech_input.removeClass("is-invalid")
                        
                  
                  }else{
                    fech_input.addClass("is-invalid")
                    error=1
                  alerta(1500, "error", "Revise la fecha")
                  }
                      for (let index = 0; index < settings.aoData[tr.row]._aData.cubierta
                        .length; index++) {
                        const element = settings.aoData[tr.row]._aData.cubierta[index]
                        if (element.nro_reencauchado == nro_input.val()) {
                          error = 1
                          alerta(1500, "error", "Ya ingresó ese número de reencauche.")
                        }
                      }
                      if (nro_input.val() > 6) {
                        error = 1
                        nro_input.addClass("is-invalid").on("input", function () {
                          nro_input.removeClass("is-invalid")
                        })
                        alerta(1500, "error", "Ingrese un numero de reencauche válido.")

                      }
                      if (alt_inicial_input.val() == "0" || alt_inicial_input.val() == "") {
                  error = 1

                  alt_inicial_input.addClass("is-invalid")
                  alt_inicial_input.on("change input", function () {
                    alt_inicial_input.removeClass("is-invalid")
                  })
                  alerta(1500, "error", "Revise los campos")
                  $(this).prop("disabled", false)

                } else {
                  let validate_a_ini = validatePunto(alt_inicial_input.val())
                  if (!validate_a_ini) {
                    error = 1
                    alt_inicial_input.addClass("is-invalid").on("input", function () {
                      alt_inicial_input.removeClass("is-invalid")
                    })
                    alerta(1500, "error", "Los campos altura inicial deben tener 2 decimales")

                  }
                }
                if (alt_final_input.val() == "0" || alt_final_input.val() == "") {
                  error = 1
                  alt_final_input.addClass("is-invalid")
                  alt_final_input.on("change input", function () {
                    alt_final_input.removeClass("is-invalid")
                  })
                  alerta(1500, "error", "Revise los campos")
                } else {
                  let validate_a_fin = validatePunto(alt_final_input.val())
                  if (!validate_a_fin) {
                    error = 1
                    alt_final_input.addClass("is-invalid").on("input", function () {
                      alt_final_input.removeClass("is-invalid")
                    })
                    alerta(1500, "error", "Los campos altura final deben tener 2 decimales")


                  }
                }
                      if (error == 0) {

                        objeto.cu.push(obj)
                        load(tabla, obj.nro_reencauchado, obj.km, obj.renovadora
                          .descripcion,
                          obj.modelo_banda.descripcion, obj.ancho_banda.descripcion, obj
                          .fech_ren, obj.alt_inicial, tr.row,obj.alt_final,settings)
                        obj = {
                          fech_ren: "",
                          alt_inicial: "",
                          alt_final: "",

                          nro_reencauchado: "",
                          km: "",
                          renovadora: {
                            id: "",
                            descripcion: ""
                          },
                          modelo_banda: {
                            id: "",
                            descripcion: ""
                          },
                          ancho_banda: {
                            id: "",
                            descripcion: ""
                          },
                        }
                        fech_input.val("")
                        alt_inicial_input.val("")
                        alt_final_input.val("")

                        km_input.val("")
                        nro_input.val("")
                        renovadora_input.select2({
                          dropdownParent: $('.jconfirm')
                        }).val("0").trigger("change")
                  
                        modelo_banda_input.empty()
                        ancho_banda_input.empty()
                      }
                    })
                  }
                });
              }
              $("select[name='marca_llanta']").each(function (index, el) {
                select = $(el).parent().next().children()
                select.append($("<option>", {
                  value: "0",
                  text: " --------- "
                }));
                if($(this).val()!="0"){
                  fetch('/catalogos/render-option-llanta/' + $(el).val()).then(res => res
                    .json())
                  .then(data => {
                    $.each(data, function (index, valuex) {
                      if (!valuex.eliminado && valuex.activo) {
                        $(el).parent().next().children().append($("<option>", {
                          value: valuex.id,
                          text: valuex.descripcion
                        }));
                      }
                    });
                    $(el).parent().next().children().find('option[value="' + settings.aoData[
                      index]._aData.modelo + '"]').attr('selected', 'selected');
                    if ($(el).parent().next().children().val() == "0" && $(el).parent().parent()
                      .find("input[name='codigo']").val() != "") {
                      $(el).parent().next().children().addClass("is-invalid")
                      $("#btn-save").prop("disabled", true)

                    }
                  })
                }
              })
              $(".btn-remove").on("click", function () {
                var tr = tablaLLantas.cell($(this).closest("td", "li")).index()

                let a = confirmar(function () {
                  objeto.items.splice(tr.row, 1)
                  objeto.list()
                  refreshStorage()

                }, "¿Desea eliminar este neumático de la lista?", function () {

                })


              })
              $(".btn-remove").hover(function () {

                  $(this).children().remove()
                  $(this).append('<i class="fas fa-times"></i>').css("width", "42px")
                  $(this).removeClass("btn-success").addClass("btn-danger");
                }, function () {
                  $(this).children().remove()
                  $(this).append('<i class="fas fa-check"></i>')
                  $(this).removeClass("btn-danger").addClass("btn-success");
                }

              )
              $("td").on("click", ".btn-add", function (e) {
                let error = 0
                var tr = tablaLLantas.cell($(this).closest("td", "li")).index()
                let codigo = $("td:eq(0)", tablaLLantas.row(tr.row).node()).children()
                let marca = $("td:eq(1)", tablaLLantas.row(tr.row).node()).children()
                let modelo = $("td:eq(2)", tablaLLantas.row(tr.row).node()).children()
                let medida = $("td:eq(3)", tablaLLantas.row(tr.row).node()).children()
                let estado = $("td:eq(4)", tablaLLantas.row(tr.row).node()).children().children()
                  .first()
                let boton = $("td:eq(4)", tablaLLantas.row(tr.row).node()).children().children()
                  .first().next()
                let fech_ren = $("td:eq(5)", tablaLLantas.row(tr.row).node()).children()
                let costo = $("td:eq(6)", tablaLLantas.row(tr.row).node()).children()
                let altura_ini = $("td:eq(7)", tablaLLantas.row(tr.row).node()).children()
                let altura_fin = $("td:eq(8)", tablaLLantas.row(tr.row).node()).children()
                data.codigo = codigo.val()
                data.marca = marca.val()
                data.modelo = modelo.val()
                data.medida = medida.val()
                data.estado = estado.val()
                data.fech_ren = fech_ren.val()
                data.costo = costo.val()
                data.altura_ini = altura_ini.val()
                data.altura_fin = altura_fin.val()
                for (let i = 0; i < settings.aoData.length - 1; i++) {
                  if (settings.aoData[i]._aData.codigo == codigo.val()) {
                    error = 1
                    alerta(1500, "error", "El codigo " + codigo.val() +
                      " ya se encuentra en la tabla.")
                    codigo.addClass("is-invalid").on("input", function (e) {
                      codigo.removeClass("is-invalid")
                    })
                  }
                }
                if (estado.val() == "2") {
                  data.cubierta.ancho_banda = settings.aoData[tr.row]._aData.cubierta.ancho_banda
                  data.cubierta.modelo_banda = settings.aoData[tr.row]._aData.cubierta
                    .modelo_banda
                  data.cubierta.renovadora = settings.aoData[tr.row]._aData.cubierta.renovadora
                  data.cubierta.km = settings.aoData[tr.row]._aData.cubierta.km
                  data.cubierta.nro_reencauchado = settings.aoData[tr.row]._aData.cubierta
                    .nro_reencauchado
                }

           

                function valid(that, name, mensaje = "Revise los campos") {
                  let ele = $(that).parent().parent().find(name)
                  if (ele.val() == "0" || ele.val() == "") {
                    error = 1
                    ele.addClass("is-invalid")
                    ele.on("change input", function () {
                      ele.removeClass("is-invalid")
                    })
                    alerta(1500, "error", mensaje)
                    $(this).prop("disabled", false)

                  }
                }

                valid(this, "[name='codigo']")
                valid(this, "[name='marca_llanta']")
                valid(this, "[name='modelo_llanta']")
                valid(this, "[name='medida_llanta']")
                valid(this, "[name='estado_llanta']")
                if (fech_ren.val() == "") {
                  alerta(1500, "error", "Revise el campo fecha.")

                  error = 1
                  fech_ren.css("border-color", "red")
                  fech_ren.on("change input", function () {
                    fech_ren.css("border-color", "black")
                  })

                }
                if (costo.val() == "") {
                  error = 1
                  costo.addClass("is-invalid").on("change input", function () {
                    costo.removeClass("is-invalid")
                  })
                  alerta(1500, "error", "Revise los campos")
                  $(this).prop("disabled", false)
                } else {
                  if (costo.val() < 0) {
                    error = 1
                    costo.addClass("is-invalid").on("change input", function () {
                      costo.removeClass("is-invalid")
                    })
                    alerta(1500, "error", "El costo debe ser positivo.")
                    $(this).prop("disabled", false)

                  }
                }

                if (altura_ini.val() == "0" || altura_ini.val() == "") {
                  error = 1

                  altura_ini.addClass("is-invalid")
                  altura_ini.on("change input", function () {
                    altura_ini.removeClass("is-invalid")
                  })
                  alerta(1500, "error", "Revise los campos")
                  $(this).prop("disabled", false)

                } else {
                  let validate_a_ini = validatePunto(altura_ini.val())
                  if (!validate_a_ini) {
                    error = 1
                    altura_ini.addClass("is-invalid").on("input", function () {
                      altura_ini.removeClass("is-invalid")
                    })
                    alerta(1500, "error", "Los campos altura inicial deben tener 2 decimales")
                    $(this).prop("disabled", false)

                  }
                }
                if (altura_fin.val() == "0" || altura_fin.val() == "") {
                  error = 1
                  altura_fin.addClass("is-invalid")
                  altura_fin.on("change input", function () {
                    altura_fin.removeClass("is-invalid")
                  })
                  alerta(1500, "error", "Revise los campos")
                  $(this).prop("disabled", false)


                } else {
                  let validate_a_fin = validatePunto(altura_fin.val())
                  if (!validate_a_fin) {
                    error = 1
                    altura_fin.addClass("is-invalid").on("input", function () {
                      altura_fin.removeClass("is-invalid")
                    })
                    alerta(1500, "error", "Los campos altura final deben tener 2 decimales")
                    $(this).prop("disabled", false)


                  }
                }
                if (settings.aoData[tr.row]._aData.cubierta.length == 0 && estado.val() == "2") {
                  error = 1
                  boton.removeClass("btn-outline-secondary")

                  boton.addClass("btn-danger")
                  alerta(1500, "error", "Ingrese uno o más reencuaches.")
                }
                if (!checkDate(fech_ren.val())) {
                  alerta(1500, "error", "Revise el campo fecha.")

                  error = 1
                  fech_ren.css("border-color", "red")
                  fech_ren.on("change input", function () {
                    fech_ren.css("border-color", "black")
                  })
                }
                if (error == 0) {
                  fetch("exist/" + codigo.val()).then(s => s.json())
                    .then(response => {
                      if (response.status == 300) {
                        $(this).parent().parent().find("[name='codigo']").addClass("is-invalid")
                          .on("input", function () {
                            $(this).parent().parent().find("[name='codigo']").removeClass(
                              "is-invalid")
                          })

                        alerta(1500, "error", "El código " + codigo.val() +
                          " ya se encuentra registrado.")
                        $("#btn-save").prop("disabled", true)

                      } else {
                        $(this).prop("disabled", false)
                        objeto.items.push(data)
                        window.localStorage.setItem("array", JSON.stringify(objeto.items))
                        data = {
                          codigo: "",
                          marca: "",
                          modelo: "",
                          medida: "",
                          estado: "",
                          altura_ini: "",
                          altura_fin: "",
                          costo: "",
                          fech_ren: "",

                          cubierta: []
                        }


                        $(this).children().remove()
                        $(this).append('<i class="fas fa-check"></i>')
                        $(this).removeClass("btn-primary").addClass("btn-success")
                        $(this).removeClass("btn-add").addClass("btn-remove")
                        $(this).hover(function () {

                            $(this).children().remove()
                            $(this).append('<i class="fas fa-times"></i>').css("width",
                              "42px")
                            $(this).removeClass("btn-success").addClass("btn-danger");
                          }, function () {
                            $(this).children().remove()
                            $(this).append('<i class="fas fa-check"></i>')
                            $(this).removeClass("btn-danger").addClass("btn-success");
                          }

                        )
                        $(this).on("click", function () {})
                        Swal.fire({
                          title: 'Neumático agregado a la lista',
                          text: "¿Desea duplicar los valores para el siguiente neumático?",
                          icon: 'success',
                          showCancelButton: true,
                          confirmButtonColor: '#3085d6',
                          cancelButtonColor: '#d33',
                          confirmButtonText: 'Sí, duplicar!'
                        }).then((result) => {
                          if (result.isConfirmed) {
                            data = {
                              codigo: "",
                              marca: settings.aoData[tr.row]._aData.marca,
                              modelo: settings.aoData[tr.row]._aData.modelo,
                              medida: settings.aoData[tr.row]._aData.medida,
                              estado: settings.aoData[tr.row]._aData.estado,
                              altura_ini: settings.aoData[tr.row]._aData.altura_ini,
                              altura_fin: settings.aoData[tr.row]._aData.altura_fin,
                              costo: settings.aoData[tr.row]._aData.costo,
                              fech_ren: settings.aoData[tr.row]._aData.fech_ren,

                              cubierta: []
                            }
                            objeto.list()

                          } else {
                            objeto.list()


                          }
                        })
                      }
                    })

                }
              })

              // $(".table-responsive").mousewheel(function (event, delta) {

              //   this.scrollLeft -= (delta * 30);

              //   event.preventDefault();

              // });
              $(".change_marca").on("change", function (e) {
                e.stopPropagation();
                var cant = $(this).val();
                var tr = tablaLLantas.cell($(this).closest("td", "li")).index()
                select = $(this).parent().next().children()

                if ($(this).val() == "0") {
                  $("#btn-save").prop("disabled", true)
                  $(this).addClass("is-invalid")
                  select.empty()
                  select.append($("<option>", {
                    value: "0",
                    text: " --------- "
                  }));
                } else {
                  $(this).removeClass("is-invalid")

                  let a = 0
                  $.each($(".form"), function (index, value) {
                    if ($(value).hasClass("is-invalid")) {

                      a = a + 1
                      $("#btn-save").prop("disabled", true)
                    }
                  });
                  if (a == 0) {
                    $("#btn-save").prop("disabled", false)
                  }
                  select.empty();
                  select.append($("<option>", {
                    value: "0",
                    text: " --------- "
                  }));

                  fetch('/catalogos/render-option-llanta/' + $(this).val()).then(res => res
                      .json())
                    .then(data => {
                      select.prop("disabled", false)
                      $.each(data, function (index, valuex) {
                        if (!valuex.eliminado && valuex.activo) {
                          let opcion = document.createElement("option")
                          opcion.value = valuex.id
                          opcion.textContent = valuex.descripcion
                          select.append(opcion)
                        }
                      });
                      select.prop("disabled", false)
                      if (select.val() == "0") {
                        $("#btn-save").prop("disabled", true)
                        select.addClass("is-invalid")
                      } else {
                        $("#btn-save").prop("disabled", false)
                        select.on("change", function () {
                          select.removeClass("is-invalid")
                        })
                      }
                    })
                  if (typeof objeto.items[tr.row] !== "undefined") {
                    objeto.items[tr.row].marca = cant;
                    refreshStorage()
                  }
                }

              })

              $("select[name='modelo_llanta']").on("change", function (e) {
                var cant = $(this).val();
                var tr = tablaLLantas.cell($(this).closest("td", "li")).index()
                if ($(this).val() == "0") {
                  $("#btn-save").prop("disabled", true)
                  $(this).addClass("is-invalid")
                } else {
                  $(this).removeClass("is-invalid")
                  let a = 0
                  $.each($(".form"), function (index, value) {
                    if ($(value).hasClass("is-invalid")) {
                      a = a + 1
                      $("#btn-save").prop("disabled", true)
                    }
                  });
                  if (a == 0) {
                    $("#btn-save").prop("disabled", false)

                  }
                  if (typeof objeto.items[tr.row] !== "undefined") {
                    objeto.items[tr.row].modelo = cant;
                    refreshStorage()
                  }
                }


              })
              $("input[name='codigo']").on("input", function (e) {
                var cant = $(this).val();
                var tr = tablaLLantas.cell($(this).closest("td", "li")).index()
                if (cant == "" || cant == "0") {
                  $("#btn-save").prop("disabled", true)
                  $(this).addClass("is-invalid").on("input", function () {
                    $(this).removeClass("is-invalid")
                  })
                } else {
                  let errorc=0
                  for (let i = 0; i < settings.aoData.length-1 ; i++) {
                    if (settings.aoData[i]._aData.codigo == cant && i != tr.row) {
                      alerta(1500, "error", "El codigo " + cant +
                        " ya se encuentra en la tabla.")
                        $(this).addClass("is-invalid")
                        errorc=1
                      break
                    }
                  }
                  if(errorc==0){
                    fetch("exist/" + cant).then(s => s.json())
                    .then(response => {
                      if (response.status == 300) {
                        $(this).addClass("is-invalid")
                        

                        alerta(1500, "error", "El código " + cant +
                          " ya se encuentra registrado.")
                        $("#btn-save").prop("disabled", true)
                        $(this).parent().parent().find(".btn-add").prop("disabled", true)

                      }else{
                        $("#btn-save").prop("disabled", false)
                        $(this).parent().parent().find(".btn-add").prop("disabled", false)
                        $(this).removeClass("is-invalid")

                      }
                    })
                  }else{
                    $(this).addClass("is-invalid")

                  }

                }
                let a = 0
                $.each($(".form"), function (index, value) {
                  if ($(value).hasClass("is-invalid")) {
                    a = a + 1
                    $("#btn-save").prop("disabled", true)
                  }
                });
                if (a == 0) {
                  if (typeof objeto.items[tr.row] !== "undefined") {
                    objeto.items[tr.row].codigo = cant;
                    refreshStorage()
                  }
                  $("#btn-save").prop("disabled", false)

                }

              })
              $("select[name='medida_llanta']").on("change", function (e) {
                var cant = $(this).val();
                var tr = tablaLLantas.cell($(this).closest("td", "li")).index()
                if ($(this).val() == "0") {
                  $("#btn-save").prop("disabled", true)
                  $(this).addClass("is-invalid")
                } else {
                  $(this).removeClass("is-invalid")

                  let a = 0
                  $.each($(".form"), function (index, value) {
                    if ($(value).hasClass("is-invalid")) {

                      a = a + 1
                      $("#btn-save").prop("disabled", true)
                    }
                  });


                  if (a == 0) {

                    if (typeof objeto.items[tr.row] !== "undefined") {
                      objeto.items[tr.row].medida = cant;
                      refreshStorage()
                    }
                    $("#btn-save").prop("disabled", false)
                  }
                }
              })
              $("td").on("click", ".btn-reencauche", function (e) {
                var cant = $(this).val();
                var tr = tablaLLantas.cell($(this).closest("td", "li")).index()
                openReencauche(tr, $(this))
              })
              $("select[name='estado_llanta']").on("change", function (e) {
                var cant = $(this).val();
                var tr = tablaLLantas.cell($(this).closest("td", "li")).index()
                if ($(this).val() == "0") {
                  $("#btn-save").prop("disabled", true)
                  $(this).addClass("is-invalid")
                  $(this).next().prop("disabled", false)

                } else
                if ($(this).val() == "2") {
                  $(this).next().prop("disabled", false)
                  $(this).next().addClass("btn-reencauche")
                  openReencauche(tr, $(this).next())
                  $(this).removeClass("is-invalid")
                  let a = 0
              

                  if (typeof objeto.items[tr.row] !== "undefined") {
                    objeto.items[tr.row].estado = cant;
                    refreshStorage()
                  }
                } else if ($(this).val() == "1") {
                  if (objeto.items.length > 0 && typeof objeto.items[tr.row] !== "undefined") {
                    objeto.items[tr.row].cubierta = []
                  }
                  $(this).next().prop("disabled", true).removeClass("btn-danger").addClass(
                    "btn-outline-secondary")
                  $(this).removeClass("is-invalid")
                  let a = 0
                  $.each($(".form"), function (index, value) {
                    if ($(value).hasClass("is-invalid")) {
                      a = a + 1
                      $("#btn-save").prop("disabled", true)

                    }
                  });

                  if (a == 0) {
                    $("#btn-save").prop("disabled", false)
                  }
                  if (typeof objeto.items[tr.row] !== "undefined") {
                    objeto.items[tr.row].estado = cant;
                    refreshStorage()
                  }
                }


              })
              $("input[name='fech_ren']").on("input", function (e) {
                e.preventDefault()
                var cant = $(this).val();
                var tr = tablaLLantas.cell($(this).closest("td", "li")).index()
                if ($(this).val() == "") {
                  $("#btn-save").prop("disabled", true)
                  $(this).addClass("is-invalid")
                } else {
                  if(checkDate($(this).val())){
                  $("#btn-save").prop("disabled", false)
                  $(this).css("border-color", "#ced4da")
                  if (typeof objeto.items[tr.row] !== "undefined") {
                    objeto.items[tr.row].fech_ren = cant;
                    refreshStorage()
                  $("#btn-save").prop("disabled", false)

                  }
                }else{
                  error = 1
                  $(this).css("border-color", "red")
                  $("#btn-save").prop("disabled", true)

                  alerta(1500, "error", "Revise la fecha")
                }
              }

              })
              $("input[name='costo']").on("change keyup", function (e) {
                e.preventDefault()
                var cant = $(this).val();
                var tr = tablaLLantas.cell($(this).closest("td", "li")).index()
                if ($(this).val() == "") {
                  $("#btn-save").prop("disabled", true)
                  $(this).addClass("is-invalid")
                } else {
                  $("#btn-save").prop("disabled", false)
                  $(this).removeClass("is-invalid")
                  if (typeof objeto.items[tr.row] !== "undefined") {
                    objeto.items[tr.row].costo = cant;
                    refreshStorage()
                  }
                }

              })
              $("input[name='a_inicial']").on("change keyup", function (e) {
                e.preventDefault()
                var cant = $(this).val();
                var tr = tablaLLantas.cell($(this).closest("td", "li")).index()
                let validate = validatePunto($(this).val())
                if (!validate) {
                  $("#btn-save").prop("disabled", true)
                  $(this).addClass("is-invalid").on("input", function () {
                    $(this).removeClass("is-invalid")
                  })
                } else {
                  $(this).removeClass("is-invalid")

                  $("#btn-save").prop("disabled", false)
                  if (typeof objeto.items[tr.row] !== "undefined") {
                    objeto.items[tr.row].altura_ini = cant;
                    refreshStorage()
                  }

                }
              })
              $("input[name='a_final']").on("change keyup", function (e) {
                e.preventDefault()
                var cant = $(this).val();
                var tr = tablaLLantas.cell($(this).closest("td", "li")).index()
                let validate = validatePunto($(this).val())
                if (!validate) {

                  $("#btn-save").prop("disabled", true)
                  $(this).addClass("is-invalid").on("input", function () {
                    $(this).removeClass("is-invalid")
                  })
                } else {
                  $(this).removeClass("is-invalid")

                  $("#btn-save").prop("disabled", false)
                  if (typeof objeto.items[tr.row] !== "undefined") {
                    objeto.items[tr.row].altura_fin = cant;
                    refreshStorage()
                  }
                }


              })




            })
          }
        });
        tablaLLantas.row.add(data).draw()

      }
    }
    if (window.localStorage.getItem("array")) {
      objeto.items = JSON.parse(window.localStorage.getItem("array"))
      objeto.list()
      console.log(objeto.items)
    } else {
      objeto.list()


    }
  });
</script>
{% endblock %}