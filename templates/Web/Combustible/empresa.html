<form action="{% url 'Web:empresa' %}" id="form_empresa" class="formName" novalidate>
<div class="form-group">
<label for="">Descripci√≥n</label>
<input type="text" name="nombre" id="nombre" class="form-control">
 <div class="invalid-feedback">
                            Este campo es requerido
                        </div>
</div>
<button type="button" class="btn d-none btn-empresa">as</button>
</form>

<script>
$(".btn-empresa").on("click",function(){
        let error=0
        if($("#nombre").val()==""){
            error=1
            $("#nombre").addClass("is-invalid").on("input",function(){
                $("#nombre").removeClass("is-invalid")
            })
        }
    if(error == 0){
            let data=new FormData(document.getElementById("form_empresa"))

     fetch($("#form_empresa").attr("action"),{
                        method: "POST",
                        headers: {
                            "X-CSRFToken": csrftoken
                        },
                        body:data
                      }).then(data => data.json()).then(response => {
                          console.log(response)
                          if (response.status==200) {
                              jc.close();
                              alerta(2000,"success","Empresa registrada!","top-end")
                              let opt=document.createElement("option")
                              opt.value=response.id
                              opt.textContent=response.nombre
                              opt.selected=true
                             document.getElementById("empresa").append(opt)

                          }else{
                              if(response.form.nombre){
                                   $("#nombre").addClass("is-invalid").on("input",function(){
                                       $("#nombre").removeClass("is-invalid")
                                   })
                                   $("#nombre").next().text(response.form.nombre[0])
                              }

                          }
                      })
    }
})
</script>

