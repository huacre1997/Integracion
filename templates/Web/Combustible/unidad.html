<form action="{% url 'Web:unidad' %}" id="form_unidad" class="formName" novalidate>
    <div class="form-group">
        <label for="">Descripción</label>
        <input type="text" name="descripcion" id="producto" class="form-control">
        <div class="invalid-feedback">
            Este campo es requerido
        </div>
    </div>
    <div class="form-group">
        <label for="">Abreviación</label>
        <input type="text" name="abrev" id="abrev" class="form-control">
        <div class="invalid-feedback">
            Este campo es requerido
        </div>
    </div>
    <button type="button" class="btn d-none" id="btn-unidad">as</button>
</form>

<script>
  $(document).ready(function () {
    // $("input").on("keyup", function () {
    //     $(this).val($(this).val().toUpperCase());
    // })
    $("#btn-unidad").on("click", function () {
        let error = 0
        console.log(document.getElementById("producto").value)

        console.log($("#producto"))
        if ($("#producto").val() == "") {
            console.log("if")
            error = 1
            $("#producto").addClass("is-invalid").on("input", function () {
                $("#producto").removeClass("is-invalid")
            })
        }
        if ($("#abrev").val() == "") {
            console.log("abrev")
            error = 1
            $("#abrev").addClass("is-invalid").on("input", function () {
                $("#abrev").removeClass("is-invalid")
            })
        }
        console.log(error)
        if (error == 0) {
            let data = new FormData(document.getElementById("form_unidad"))

            fetch($("#form_unidad").attr("action"), {
                method: "POST",
                headers: {
                    "X-CSRFToken": csrftoken
                },
                body: data
            }).then(data => data.json()).then(response => {
                console.log(response)
                if (response.status == 200) {
                    jc.close();
                    alerta(2000, "success", "Unidad de medida registrada!", "top-end")
                    let opt = document.createElement("option")
                    opt.value = response.id
                    opt.textContent = response.descripcion
                    opt.selected = true
                    document.getElementById("unidad").append(opt)

                } else {
                    if (response.form.descripcion) {
                        $("#producto").addClass("is-invalid").on("input", function () {
                            $("#producto").removeClass("is-invalid")
                        })
                        $("#producto").next().text(response.form.descripcion[0])
                    }
                    if (response.form.abrev) {
                        $("#abrev").addClass("is-invalid").on("input", function () {
                            $("#abrev").removeClass("is-invalid")
                        })
                        $("#abrev").next().text(response.form.abrev[0])
                    }

                }
            })
        }
    })
  });
</script>